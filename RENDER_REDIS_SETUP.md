# Render Redis é…ç½®æŒ‡å—

## é—®é¢˜è¯Šæ–­
ä½ çš„åº”ç”¨åŠ è½½æ…¢çš„ä¸»è¦åŸå› æ˜¯ï¼š**Redis ç¼“å­˜æœªé…ç½®ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½åœ¨æŸ¥è¯¢æ•°æ®åº“ï¼**

## è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1ï¼šåˆ›å»º Redis æœåŠ¡

1. ç™»å½• Render Dashboard: https://dashboard.render.com
2. ç‚¹å‡» **New** > **Redis**
3. é…ç½®å¦‚ä¸‹ï¼š
   ```
   Name: aipush-redis
   Plan: Free (25MB) æˆ– Starter ($7/æœˆ, 256MB)
   Region: é€‰æ‹©ä¸åç«¯ç›¸åŒçš„åŒºåŸŸï¼ˆå‡å°‘å»¶è¿Ÿï¼‰
   ```
4. ç‚¹å‡» **Create Redis**
5. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦1-2åˆ†é’Ÿï¼‰

### æ­¥éª¤ 2ï¼šè·å–è¿æ¥ä¿¡æ¯

åˆ›å»ºå®Œæˆåï¼Œä½ ä¼šçœ‹åˆ°ï¼š
```
Internal Redis URL: redis://red-xxxxx:6379
```

å¤åˆ¶è¿™ä¸ª URLï¼ˆåŒ…å« `redis://` å‰ç¼€ï¼‰

### æ­¥éª¤ 3ï¼šé…ç½®åç«¯ç¯å¢ƒå˜é‡

1. è¿›å…¥ä½ çš„åç«¯æœåŠ¡ï¼š`aipush-backend`
2. ç‚¹å‡» **Environment** æ ‡ç­¾
3. æ·»åŠ ç¯å¢ƒå˜é‡ï¼š

**æ–¹æ³• Aï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨å®Œæ•´ URL**
```
Key: REDIS_URL
Value: redis://red-xxxxx:6379
```

**æ–¹æ³• Bï¼šåˆ†å¼€é…ç½®**
```
Key: REDIS_HOST
Value: red-xxxxx.render.com

Key: REDIS_PORT
Value: 6379
```

4. ç‚¹å‡» **Save Changes**
5. Render ä¼šè‡ªåŠ¨é‡å¯æœåŠ¡

### æ­¥éª¤ 4ï¼šéªŒè¯é…ç½®

ç­‰å¾…æœåŠ¡é‡å¯åï¼ˆçº¦2-3åˆ†é’Ÿï¼‰ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š

1. è¿›å…¥ **Logs** æ ‡ç­¾
2. æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š

âœ… **æˆåŠŸæ ‡å¿—ï¼š**
```
[RedisService] Connecting to Redis using URL: redis://red-****:6379
[RedisService] âœ… Redis connection established successfully
```

âŒ **å¤±è´¥æ ‡å¿—ï¼š**
```
[RedisService] Redis not configured, caching will be disabled
[RedisService] Failed to connect to Redis
```

### æ­¥éª¤ 5ï¼šæµ‹è¯•æ€§èƒ½

è®¿é—®ä½ çš„ç½‘ç«™ï¼Œåˆ·æ–°å‡ æ¬¡é¦–é¡µï¼Œåº”è¯¥ä¼šçœ‹åˆ°ï¼š
- **ç¬¬ä¸€æ¬¡åŠ è½½**: 200-500msï¼ˆæ•°æ®åº“æŸ¥è¯¢ï¼‰
- **ç¬¬äºŒæ¬¡åŠ è½½**: 50-100msï¼ˆRedis ç¼“å­˜ï¼‰ âœ¨

## æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | æ—  Redis | æœ‰ Redis | æ”¹å–„ |
|------|----------|----------|------|
| é¦–é¡µåŠ è½½ | 200-500ms | 50-100ms | â¬‡ 75% |
| ç¿»é¡µ | 200-300ms | 50-100ms | â¬‡ 60% |
| æœç´¢ | 600-2000ms | 100-200ms | â¬‡ 85% |

## å¸¸è§é—®é¢˜

### Q1: å…è´¹ç‰ˆ Redis å¤Ÿç”¨å—ï¼Ÿ
- âœ… å¯¹äºå°æµé‡ç½‘ç«™ï¼ˆ<1000 æ—¥æ´»ï¼‰è¶³å¤Ÿ
- âš ï¸ 25MB å†…å­˜é™åˆ¶ï¼Œçº¦å¯ç¼“å­˜ 500-1000 æ¡æ–°é—»
- ğŸ’¡ å¦‚æœç»å¸¸çœ‹åˆ°ç¼“å­˜å¤±æ•ˆï¼Œè€ƒè™‘å‡çº§åˆ° Starter ($7/æœˆ)

### Q2: Redis å’Œåç«¯åœ¨ä¸åŒåŒºåŸŸä¼šæ…¢å—ï¼Ÿ
- âš ï¸ æ˜¯çš„ï¼è·¨åŒºåŸŸå»¶è¿Ÿå¯èƒ½å¢åŠ  50-200ms
- ğŸ’¡ **åŠ¡å¿…é€‰æ‹©ç›¸åŒåŒºåŸŸ**ï¼ˆå¦‚éƒ½åœ¨ Oregon, USAï¼‰

### Q3: å¦‚ä½•ç›‘æ§ Redis çŠ¶æ€ï¼Ÿ
è®¿é—®ä½ çš„ APIï¼š
```bash
curl https://your-api.onrender.com/api/v1/redis/health
curl https://your-api.onrender.com/api/v1/redis/stats
```

### Q4: ä»ç„¶å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ

æ£€æŸ¥æ•°æ®åº“ç´¢å¼•ï¼š
```bash
# åœ¨ Render Shell ä¸­è¿è¡Œ
cd apps/api
npx prisma migrate deploy
```

æŸ¥çœ‹æ—¥å¿—ä¸­çš„æ…¢æŸ¥è¯¢ï¼š
```
[Nest] Query took 1234ms
```

## è¿›é˜¶ä¼˜åŒ–

é…ç½®å®Œ Redis åï¼Œè¿˜å¯ä»¥ï¼š

1. **è°ƒæ•´ç¼“å­˜ TTL**ï¼ˆåœ¨ `apps/api/src/common/redis/cache-strategy.service.ts:29`ï¼‰
   ```typescript
   defaultTTL: 1800, // 30åˆ†é’Ÿ -> å¯æ”¹ä¸º 3600 (1å°æ—¶)
   ```

2. **æ·»åŠ æ•°æ®åº“ç´¢å¼•**ï¼ˆè¿è¡Œè¿ç§»ï¼‰
   ```bash
   pnpm prisma migrate deploy
   ```

3. **å¯ç”¨ CDN ç¼“å­˜**ï¼ˆCloudflare å…è´¹ç‰ˆï¼‰

## è¯Šæ–­è„šæœ¬

ä½¿ç”¨è¯Šæ–­è„šæœ¬æ£€æŸ¥é…ç½®ï¼š
```bash
node scripts/diagnose-render.js https://your-api.onrender.com
```

---

**é¢„è®¡ä¿®å¤æ—¶é—´**: 10-15åˆ†é’Ÿ
**é¢„æœŸæ€§èƒ½æå‡**: 60-85%
**æˆæœ¬**: $0ï¼ˆå…è´¹ç‰ˆï¼‰æˆ– $7/æœˆï¼ˆæ¨èç‰ˆï¼‰

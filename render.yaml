# Render 部署配置
services:
  # 后端 API 服务
  - type: web
    name: aipush-backend
    runtime: node
    plan: free
    buildCommand: chmod +x scripts/render-build.sh && bash scripts/render-build.sh
    startCommand: cd apps/api && node dist/apps/api/src/main.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 4000
      - key: GLM_API_KEY
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: aipush-db
          property: connectionString
      # Redis 配置（可选 - 如果不配置，缓存功能会自动禁用）
      # 要启用 Redis 缓存，请在 Render 控制台手动添加：
      # - REDIS_HOST
      # - REDIS_PORT
      - key: CORS_ORIGIN
        value: https://xibaohuole.github.io
    healthCheckPath: /api/v1/health

databases:
  # PostgreSQL 数据库
  - name: aipush-db
    plan: free
    databaseName: aipush
    user: aipush

  # Redis 缓存（可选 - 暂时不创建，代码会自动降级）
  # 如果需要启用缓存，请手动创建 Redis 服务并添加环境变量
  # - name: aipush-redis
  #   plan: free
